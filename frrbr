 Настроим протокол OSPF на HQ-RTR средствами FRR.
 Установим FRR на HQ-RTR: apt install frr
 Для настройки внутренней динамической маршрутизации для IPv4
 используем протокол OSPFv2
 Необходимо включить соответствующий демон в конфигурации
 /etc/frr/daemons
 Пропишем
 nano /etc/frr/daemons
 Вконфигурационном файле /etc/frr/daemons необходимо активировать
 выбранный протокол для дальнейшей реализации его настройки:
 ospfd = yes
 Включаем и добавляем в автозагрузку службу FRR
 systemctl enable--now frr
 systemctl restart frr
 Переходим в интерфейс управления симуляцией FRR при помощи vtysh
 (аналог cisco)
 vtysh
 Входим в режим глобальной конфигурации
 hq-rtr.au-team.irpo# configure terminal
 Переходим в режим конфигурации OSPFv2
 hq-rtr.au-team.irpo(config)# router ospf
Указываем router-id
 hq-rtr.au-team.irpo(config)# router-id 1.1.1.1
 Переводим все интерфейсы в пассивный режим
 hq-rtr.au-team.irpo(config-router)# passive-interface default
 Объявляем локальные сети офиса HQ (сеть VLAN100 и VLAN200) и сеть
 (GRE-туннеля)
 hq-rtr.au-team.irpo(config-router)# network 192.168.100.0/26
 area 0
 hq-rtr.au-team.irpo(config-router)# network 192.168.100.64/28
 area 0
 hq-rtr.au-team.irpo(config-router)# network 10.10.0.0/30 area 0
 Настройка аутентификации для области
 area 0 authentication
 Переводим интерфейс tun1 в активный режим
 hq-rtr.au-team.irpo(config-if)# no passive-interface
 tun1tterface tun1
 Выходим из режима конфигурации OSPFv2
 hq-rtr.au-team.irpo(config-router)# exit
 Переходим в режим конфигурирования интерфейса tun1
 hq-rtr.au-team.irpo(config)# interface tun1
 Туннельный интерфейс tun1 делаем активным, для установления соседства с
 BR-RTR иобмена внутренними маршрутами
 hq-rtr.au-team.irpo(config-if)# no ip ospf network broadcast
 Настройка аутентификации с открытым паролем password
 ip ospf authentication
 ip ospf authentication-key password
 Выходим из режима конфигурации и tun1 и режима глобальной
 конфигурации
 hq-rtr.au-team.irpo(config-if)# exit
hq-rtr.au-team.irpo(config)# exit
 Сохраняем текущую конфигурацию:
 hq-rtr.au-team.irpo# write
 hq-rtr.au-team.irpo# exit
 Перезапускаем FRR:systemctl restart frr







 Настроим протокол OSPF на BR-RTR средствами FRR.
 Установим FRR на BR-RTR: apt install frr
 Для настройки внутренней динамической маршрутизации для IPv4
 используем протокол OSPFv2
 Необходимо включить соответствующий демон в конфигурации
 /etc/frr/daemons
 Пропишем
 nano /etc/frr/daemons
 Вконфигурационном файле /etc/frr/daemons необходимо активировать
 выбранный протокол для дальнейшей реализации его настройки:
 ospfd = yes
 Включаем и добавляем в автозагрузку службу FRR
 systemctl enable--now frr
 systemctl restart frr
 Переходим в интерфейс управления симуляцией FRR при помощи vtysh
 (аналог cisco)
 vtysh
 Входим в режим глобальной конфигурации
 br-rtr.au-team.irpo# configure terminal
 Переходим в режим конфигурации OSPFv2
 br-rtr.au-team.irpo(config)# router ospf
 Указываем router-id
br-rtr.au-team.irpo(config)# router-id 2.2.2.2
 Переводим все интерфейсы в пассивный режим
 br-rtr.au-team.irpo(config-router)# passive-interface default
 Объявляем локальные сети офиса BR (сеть VLAN100 и VLAN200) и сеть
 (GRE-туннеля)
 br-rtr.au-team.irpo(config-router)# network 192.168.200.0/27
 area 0
 br-rtr.au-team.irpo(config-router)# network 10.10.0.0/30 area 0
 Настройка аутентификации для области
 area 0 authentication
 Переводим интерфейс tun1 в активный режим
 br-rtr.au-team.irpo(config-if)# no passive-interface
 tun1tterface tun1
 Выходим из режима конфигурации OSPFv2
 br-rtr.au-team.irpo(config-router)# exit
 Переходим в режим конфигурирования интерфейса tun1
 br-rtr.au-team.irpo(config)# interface tun1
 Туннельный интерфейс tun1 делаем активным, для установления соседства с
 HQ-RTRиобмена внутренними маршрутами
 br-rtr.au-team.irpo(config-if)# no ip ospf network broadcast
 Настройка аутентификации с открытым паролем password
 ip ospf authentication
 ip ospf authentication-key password
 Выходим из режима конфигурации и tun1 и режима глобальной
 конфигурации
 br-rtr.au-team.irpo(config-if)# exit
 br-rtr.au-team.irpo(config)# exit
 Сохраняем текущую конфигурацию:
 br-rtr.au-team.irpo# write
br-rtr.au-team.irpo# exit
 Перезапускаем FRR:systemctl restart frr
 Можемпроверить настройки на обоих маршрутизаторах командами:
 vtysh
 show running-confi






Проверим, что все работает. Пинганем с BR-SRV HQ-SRV и после пинганем
 с BR-SRV HQ-CLI.
 ping 192.168.100.2
ping 192.168.100.66
 Всё пингуется, работает

















root@br-rtr:/etc/frr# cat daemons



# This file tells the frr package which daemons to start.
#
# Sample configurations for these daemons can be found in
# /usr/share/doc/frr/examples/.
#
# ATTENTION:
#
# When activating a daemon for the first time, a config file, even if it is
# empty, has to be present *and* be owned by the user and group "frr", else
# the daemon will not be started by /etc/init.d/frr. The permissions should
# be u=rw,g=r,o=.
# When using "vtysh" such a config file is also needed. It should be owned by
# group "frrvty" and set to ug=rw,o= though. Check /etc/pam.d/frr, too.
#
# The watchfrr, zebra and staticd daemons are always started.
#
bgpd=no
ospfd=yes
ospf6d=no
ripd=no
ripngd=no
isisd=no
pimd=no
ldpd=no
nhrpd=no
eigrpd=no
babeld=no
sharpd=no
pbrd=no
bfdd=no
fabricd=no
vrrpd=no

#
# If this option is set the /etc/init.d/frr script automatically loads
# the config via "vtysh -b" when the servers are started.
# Check /etc/pam.d/frr if you intend to use "vtysh"!
#
vtysh_enable=yes
zebra_options="  -A 127.0.0.1 -s 90000000"
bgpd_options="   -A 127.0.0.1"
ospfd_options="  -A 127.0.0.1"
ospf6d_options=" -A ::1"
ripd_options="   -A 127.0.0.1"
ripngd_options=" -A ::1"
isisd_options="  -A 127.0.0.1"
pimd_options="   -A 127.0.0.1"
ldpd_options="   -A 127.0.0.1"
nhrpd_options="  -A 127.0.0.1"
eigrpd_options=" -A 127.0.0.1"
babeld_options=" -A 127.0.0.1"
sharpd_options=" -A 127.0.0.1"
pbrd_options="   -A 127.0.0.1"
staticd_options="-A 127.0.0.1"
bfdd_options="   -A 127.0.0.1"
fabricd_options="-A 127.0.0.1"
vrrpd_options="  -A 127.0.0.1"

# configuration profile
#
#frr_profile="traditional"
#frr_profile="datacenter"

#
# This is the maximum number of FD's that will be available.
# Upon startup this is read by the control files and ulimit
# is called.  Uncomment and use a reasonable value for your
# setup if you are expecting a large number of peers in
# say BGP.
#MAX_FDS=1024

# The list of daemons to watch is automatically generated by the init script.
#watchfrr_options=""

# To make watchfrr create/join the specified netns, use the following option:
#watchfrr_options="--netns"
# This only has an effect in /etc/frr/<somename>/daemons, and you need to
# start FRR with "/usr/lib/frr/frrinit.sh start <somename>".

# for debugging purposes, you can specify a "wrap" command to start instead
# of starting the daemon directly, e.g. to use valgrind on ospfd:
#   ospfd_wrap="/usr/bin/valgrind"
# or you can use "all_wrap" for all daemons, e.g. to use perf record:
#   all_wrap="/usr/bin/perf record --call-graph -"
# the normal daemon command is added to this at the end.

root@br-rtr:/etc/frr# cat frr.conf


frr version 7.5.1
frr defaults traditional
hostname br-rtr.au-team.irpo
log syslog informational
no ipv6 forwarding
service integrated-vtysh-config
!
interface tun1
ip ospf authentication message-digest
ip ospf message-digest-key 1 md5 Test123
!
router ospf
network 10.10.0.0/30 area 0
network 192.168.200.0/27 area 0
area 0 authentication message-digest
!
line vty
!



root@br-rtr:/etc/frr# cat frr.conf.sav


# default to using syslog. /etc/rsyslog.d/45-frr.conf places the log
# in /var/log/frr/frr.log
log syslog informational



root@br-rtr:/etc/frr# cat support_bundle_commands.conf



# FRR Support Bundle Command List
# Do Not modify the lines that start with
# PROC_NAME, CMD_LIST_START and CMD_LIST_END
# Add the new command for each process between
# CMD_LIST_START and CMD_LIST_END lines

# BGP Support Bundle Command List
PROC_NAME:bgp
CMD_LIST_START
show bgp summary
show ip bgp
show ip bgp neighbors
show ip bgp summary
show ip bgp statistics

show ip bgp update-groups advertise-queue
show ip bgp update-groups advertised-routes
show ip bgp update-groups packet-queue
show ip bgp update-groups statistics
show ip bgp peer-group
show ip bgp memory

show bgp ipv6
show bgp ipv6 neighbors
show bgp ipv6 summary
show bgp ipv6 update-groups advertise-queue
show bgp ipv6 update-groups advertised-routes
show bgp ipv6 update-groups packet-queue
show bgp ipv6 update-groups statistics
show ip bgp statistics
show bgp martian next-hop

show bgp evpn route
CMD_LIST_END

# Zebra Support Bundle Command List
PROC_NAME:zebra
CMD_LIST_START
show zebra
show zebra client summary
show ip nht vrf all
show route-map
show memory
show interface vrf all
show vrf
show zebra fpm stats
show error all
show work-queues
show debugging hashtable
show running-config
show thread cpu
show thread poll
show daemons
show version
CMD_LIST_END

# OSPF Support Bundle Command List
# PROC_NAME:ospf
# CMD_LIST_START
# CMD_LIST_END

# RIP Support Bundle Command List
# PROC_NAME:rip
# CMD_LIST_START
# CMD_LIST_END

# ISIS Support Bundle Command List
# PROC_NAME:isis
# CMD_LIST_START
# CMD_LIST_END

# BFD Support Bundle Command List
# PROC_NAME:bfd
# CMD_LIST_START
# CMD_LIST_END

# STATIC Support Bundle Command List
# PROC_NAME:static
# CMD_LIST_START
# CMD_LIST_END

# PIM Support Bundle Command List
# PROC_NAME:pim
# CMD_LIST_START
# CMD_LIST_END



root@br-rtr:/etc/frr# cat vtysh.conf


service integrated-vtysh-config

